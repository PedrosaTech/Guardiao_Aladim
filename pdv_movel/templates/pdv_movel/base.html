{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="theme-color" content="#2980b9">
    <link rel="manifest" href="{% static 'pdv_movel/manifest.json' %}">
    <title>{% block title %}PDV M√≥vel - Guardi√£o Aladin{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'pdv_movel/css/base.css' %}">
    <link rel="stylesheet" href="{% static 'pdv_movel/css/components.css' %}">
    <link rel="stylesheet" href="{% static 'pdv_movel/css/tablet.css' %}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
        <p>Carregando...</p>
    </div>

    {% if user.is_authenticated %}
    <header class="header">
        <div class="header-left">
            <span class="logo">üéÜ Guardi√£o Aladin</span>
            {% if atendente %}
            <span class="atendente-info">{{ atendente.user.get_full_name|default:atendente.user.username }}</span>
            {% endif %}
        </div>
        <div class="header-right">
            {% if loja %}<span class="loja-info">{{ loja.nome }}</span>{% endif %}
            <button type="button" class="btn-icon" onclick="voltarMenu()" aria-label="Menu">‚ò∞</button>
            <button type="button" class="btn-icon" onclick="sair()" aria-label="Sair">‚èª</button>
        </div>
    </header>
    {% endif %}

    <main class="main-content">
        {% if messages %}
        <div class="messages">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% block content %}{% endblock %}
    </main>

    <div id="toast-container" class="toast-container"></div>

    <script src="{% static 'pdv_movel/js/utils.js' %}"></script>
    <script src="{% static 'pdv_movel/js/api.js' %}"></script>
    {% block extra_js %}{% endblock %}

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('{% url "pdv_movel:sw_js" %}', { scope: '/pdv-movel/' })
                .then(function(r) { console.log('Service Worker registrado'); })
                .catch(function(e) { console.log('Erro ao registrar SW:', e); });
        }
        function voltarMenu() { window.location.href = '{% url "pdv_movel:pedido_novo" %}'; }
        function sair() {
            if (confirm('Deseja realmente sair?')) window.location.href = '{% url "pdv_movel:logout" %}';
        }
    </script>
</body>
</html>
